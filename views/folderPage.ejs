<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <h2>your drive</h2>
    <button class="new-folder-button">create new folder</button>

    <div class="folder-and-files-container">
        <% folders.forEach((folder)=> { %>
            <a href="/drive/<%= folder.id %>" class="folder-achor-tag">
                <div class="folder-div" data-folder-id="<%= folder.id %>">

                    <div class="folder-title-div">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-folder-icon lucide-folder">
                            <path
                                d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" />
                        </svg>
                        <p>
                            <%= folder.name %>
                        </p>
                    </div>

                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-ellipsis-vertical-icon lucide-ellipsis-vertical three-dots-icon">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="12" cy="5" r="1" />
                        <circle cx="12" cy="19" r="1" />
                    </svg>

                    <div class="folder-options-dialog">
                        <form action="/drive/del/<%= folder.id %>" method="post" class="delete-folder-form">
                            <button type="submit" class="menu-delete" data-folder-id="<%= folder.id %>">delete</button>
                        </form>
                        <p class="menu-rename" data-folder-id="<%= folder.id %>" data-folder-name="<%= folder.name %>">rename</p>
                    </div>

                    <dialog class="folder-rename-dialog">
                        <form action="/drive/rename/<%= folder.id %>" method="post">
                            <input type="text" name="folder-id" id="folder-id" hidden>
                            <div>
                                <input type="text" name="folder-rename" id="folder-rename">
                            </div>
                            <button type="reset" class="cancel-folder-rename-button" id="cancel-folder-rename-button">CANCEL</button>
                            <button type="submit" class="submit-rename-folder-button" id="submit-rename-folder-button">RENAME</button>
                        </form>
                    </dialog>

                </div>
            </a>
            <% }) %>
    </div>

    <dialog class="create-folder-dialog">
        <form action="/drive/newfolder" method="post">
            <input type="hidden" name="parent-folder-id" value="<%= parentFolderId %>">
            <div>
                <label for="folder-name">Name?</label>
                <input type="text" name="folder-name" id="folder-name">
            </div>
            <button type="reset" class="cancel-new-folder-button">CANCEL</button>
            <button type="submit" class="create-new-folder-button">CREATE</button>
        </form>
    </dialog>

    <script>
        let newFolderButton = document.querySelector(".new-folder-button");
        let deleteFolderForms = document.querySelectorAll(".delete-folder-form");
        let createFolderDialog = document.querySelector(".create-folder-dialog");
        let createNewFolderButton = document.querySelector(".create-new-folder-button");
        let cancelNewFolderButton = document.querySelector(".cancel-new-folder-button");
        let threeDotsIcons = document.querySelectorAll(".three-dots-icon");
        let folderOptionsDialogs = document.querySelectorAll(".folder-options-dialog");
        let folderDivs = document.querySelectorAll(".folder-div");
        let renameFolderButtons = document.querySelectorAll(".menu-rename");
        let folderRenameDialog = document.querySelector(".folder-rename-dialog");
        let cancelFolderRenameButton = document.querySelector("#cancel-folder-rename-button");
        let submitFolderRenameButton = document.querySelector("#submit-folder-rename-button");
     

        newFolderButton.addEventListener("click", () => {

            createFolderDialog.showModal();
        });


        renameFolderButtons.forEach((renameButton) => {
            renameButton.addEventListener("click", (event) => {

                event.stopPropagation();
                event.preventDefault();

                const folderId = renameButton.dataset.folderId;
                const folderName = renameButton.dataset.folderName;

                folderRenameDialog.showModal();
                document.querySelector("#folder-id").value = folderId;
                document.querySelector("#folder-rename").value = folderName;

            })
        })  

        cancelFolderRenameButton.addEventListener("click",(event)=>{
            event.stopPropagation();
            document.querySelector(".folder-rename-dialog").close();
        })

      

        deleteFolderForms.forEach((form) => {
            form.addEventListener("submit", (event) => {
                event.stopPropagation();

                // event.preventDefault();

            })
        })


        createNewFolderButton.addEventListener("click", () => {
            createFolderDialog.close();
        });

        cancelNewFolderButton.addEventListener("click", () => {
            createFolderDialog.close();
        });


        folderDivs.forEach((folder) => {
            const threeDots = folder.querySelector(".three-dots-icon");
            const dialog = folder.querySelector(".folder-options-dialog");

            threeDots.addEventListener("click", (event) => {
                event.preventDefault();
                event.stopPropagation(); //event delegation



                if (dialog.style.visibility === "visible") {
                    dialog.style.visibility = "hidden";
                } else {

                    document.querySelectorAll(".folder-options-dialog").forEach(dialog => dialog.style.visibility = "hidden");
                    dialog.style.visibility = "visible";
                }
            });
        });


    </script>
</body>

</html>